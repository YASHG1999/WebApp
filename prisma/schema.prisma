generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  VISITOR
  ADMIN
  REVENUEMANAGER
  CLUSTERMANAGER
  SHIFTMANAGER
  FRANCHISEOWNER
  CONSUMER
  WAREHOUSEADMIN
}

model user {
    id   String @id @default(uuid())
    name String? @db.VarChar(100)
    country_code String? @db.VarChar(5)
    phone_number String? @unique @db.VarChar(15)
    email String? @db.VarChar(255)
    avatar_url String? @db.VarChar(255)
    phone_confirmed_at DateTime?
    email_confirmed_at DateTime?
    last_sign_in_at DateTime?
    meta_data Json? @db.JsonB
    is_active Boolean @default(true)
    banned_until DateTime?
    roles UserRole[] @default([VISITOR])
    created_at DateTime @default(now())
    updated_at DateTime @updatedAt
    upadted_by String?
    refresh_tokens refresh_token[]
    devices devices[]
    otp otp_tokens[]
    @@index([phone_number])
}

model otp_tokens {
  id   BigInt @id @default(autoincrement())
  otp String @db.VarChar(6)
  user_id String
  phone_number String @db.VarChar(12)
  valid_till DateTime @default(now())
  sent_at DateTime @default(now())
  retries_count Int?
  retries_allowed Int?
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  upadted_by String?
  otp_user_mapping user @relation(fields: [user_id], references: [id])
  @@index([phone_number])
}

model refresh_token {
  id BigInt @id @default(autoincrement())
  token String @unique @db.VarChar(255)
  user_id String
  valid_till DateTime @default(now())
  revoked Boolean @default(false)
  created_at DateTime? @default(now())
  updated_at DateTime? @updatedAt
  upadted_by String?
  token_user_mapping user @relation(fields: [user_id], references: [id])
  @@index([user_id])
}

model devices {
  id String @id @default(uuid())
  user_id String
  device_id String @unique
  mac_address String? @db.VarChar(100)
  manufacturer String? @db.VarChar(100)
  model String? @db.VarChar(100)
  os String? @db.VarChar(100)
  app_version String? @db.VarChar(20)
  is_active Boolean @default(true)
  last_refreshed_at DateTime?
  notification_token String? @db.VarChar(255)
  created_at DateTime? @default(now())
  updated_at DateTime? @updatedAt
  upadted_by String?
  device_user_mapping user @relation(fields: [user_id], references: [id])
  @@index([user_id])
}
