generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum UserRole {
  ADMIN
  REVENUEMANAGER
  CLUSTERMANAGER
  SHIFTMANAGER
  FRANCHISEOWNER
  CONSUMER
  WAREHOUSEADMIN
}

model user {
    id   String @id @default(uuid())
    name String? @db.VarChar(255)

    phone_number String @unique @db.VarChar(15)

    email String? @db.VarChar(255)

    avatar_url String? @db.VarChar(255)

    phone_confirmed_at DateTime?

    email_confirmed_at DateTime?

    last_sign_in_at DateTime?

    meta_data Json?

    is_active Boolean @default(true)

    banned_until DateTime?

    is_super_admin Boolean @default(false)

    roles UserRole @default(CONSUMER) //make an array

    created_at DateTime @default(now())
    updated_at DateTime @updatedAt
    upadted_by String

    refresh_tokens refresh_token[]
    device_mapping devices[]
}

model otp_tokens {
  id   BigInt @id @default(autoincrement())

  otp Int

  user_id String?

  phone_number String @db.VarChar(15)

  valid_till DateTime

  sent_at DateTime

  retries_count Int?

  retries_allowed Int?

  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
  upadted_by String?
}

model refresh_token {
  id       BigInt                    @id @default(autoincrement())
  token String @unique @db.VarChar(255)
  user_id String
  device_id String @unique
  valid_till DateTime
  revoked Boolean

  created_at DateTime? @default(now())
  updated_at DateTime? @updatedAt
  upadted_by String?

  user_token_mapping user @relation(fields: [user_id], references: [id])
  device_token_mapping devices @relation(fields: [device_id], references: [id])
}

model devices {
  id       String @id @default(uuid())
  user_id String
  device_id String @unique
  mac_address String?
  manufacturer String?
  model String?
  os String?
  app_version String?
  is_active Boolean @default(true)
  last_refreshed_at DateTime?
  notification_token String?

  created_at DateTime? @default(now())
  updated_at DateTime? @updatedAt
  upadted_by String?

  device_token_mapping refresh_token[]
  device_user_mapping   user @relation(fields: [user_id], references: [id])
}
